radio.onReceivedNumber(function (receivedNumber) {
  music.setTempo(160);
  if (receivedNumber == 1) {
    music.rest(music.beat(BeatFraction.Half));
    music.play(
      music.tonePlayable(370, music.beat(BeatFraction.Half)),
      music.PlaybackMode.UntilDone
    );
    music.rest(music.beat(BeatFraction.Half));
    music.play(
      music.tonePlayable(440, music.beat(BeatFraction.Half)),
      music.PlaybackMode.UntilDone
    );
    music.play(
      music.tonePlayable(554, music.beat(BeatFraction.Half)),
      music.PlaybackMode.UntilDone
    );
    music.rest(music.beat(BeatFraction.Half));
    music.play(
      music.tonePlayable(440, music.beat(BeatFraction.Half)),
      music.PlaybackMode.UntilDone
    );
    music.rest(music.beat(BeatFraction.Half));
    music.play(
      music.tonePlayable(370, music.beat(BeatFraction.Half)),
      music.PlaybackMode.UntilDone
    );
    music.play(
      music.tonePlayable(294, music.beat(BeatFraction.Quarter)),
      music.PlaybackMode.UntilDone
    );
    music.rest(music.beat(BeatFraction.Quarter));
    music.play(
      music.tonePlayable(294, music.beat(BeatFraction.Quarter)),
      music.PlaybackMode.UntilDone
    );
    music.rest(music.beat(BeatFraction.Quarter));
    music.play(
      music.tonePlayable(294, music.beat(BeatFraction.Half)),
      music.PlaybackMode.UntilDone
    );
    music.rest(music.beat(BeatFraction.Half));
    music.play(
      music.tonePlayable(659, music.beat(BeatFraction.Quarter)),
      music.PlaybackMode.UntilDone
    );
    music.rest(music.beat(BeatFraction.Quarter));
    music.play(
      music.tonePlayable(659, music.beat(BeatFraction.Quarter)),
      music.PlaybackMode.UntilDone
    );
    music.rest(music.beat(BeatFraction.Quarter));
    music.play(
      music.tonePlayable(659, music.beat(BeatFraction.Half)),
      music.PlaybackMode.UntilDone
    );
    music.rest(music.beat(BeatFraction.Half));
    music.play(
      music.tonePlayable(277, music.beat(BeatFraction.Half)),
      music.PlaybackMode.UntilDone
    );
    music.play(
      music.tonePlayable(294, music.beat(BeatFraction.Half)),
      music.PlaybackMode.UntilDone
    );
    music.play(
      music.tonePlayable(370, music.beat(BeatFraction.Half)),
      music.PlaybackMode.UntilDone
    );
    music.play(
      music.tonePlayable(440, music.beat(BeatFraction.Half)),
      music.PlaybackMode.UntilDone
    );
    music.play(
      music.tonePlayable(554, music.beat(BeatFraction.Half)),
      music.PlaybackMode.UntilDone
    );
    music.rest(music.beat(BeatFraction.Half));
    music.play(
      music.tonePlayable(440, music.beat(BeatFraction.Half)),
      music.PlaybackMode.UntilDone
    );
    music.rest(music.beat(BeatFraction.Half));
    music.play(
      music.tonePlayable(370, music.beat(BeatFraction.Half)),
      music.PlaybackMode.UntilDone
    );
    music.play(
      music.tonePlayable(659, music.beat(BeatFraction.Whole)),
      music.PlaybackMode.UntilDone
    );
    music.play(
      music.tonePlayable(659, music.beat(BeatFraction.Half)),
      music.PlaybackMode.UntilDone
    );
    music.play(
      music.tonePlayable(622, music.beat(BeatFraction.Half)),
      music.PlaybackMode.UntilDone
    );
    music.play(
      music.tonePlayable(587, music.beat(BeatFraction.Whole)),
      music.PlaybackMode.UntilDone
    );
    music.rest(music.beat(BeatFraction.Whole));
    music.play(
      music.tonePlayable(494, music.beat(BeatFraction.Half)),
      music.PlaybackMode.UntilDone
    );
    music.play(
      music.tonePlayable(392, music.beat(BeatFraction.Half)),
      music.PlaybackMode.UntilDone
    );
    music.play(
      music.tonePlayable(294, music.beat(BeatFraction.Half)),
      music.PlaybackMode.UntilDone
    );
    music.play(
      music.tonePlayable(277, music.beat(BeatFraction.Whole)),
      music.PlaybackMode.UntilDone
    );
    music.play(
      music.tonePlayable(494, music.beat(BeatFraction.Half)),
      music.PlaybackMode.UntilDone
    );
    music.play(
      music.tonePlayable(392, music.beat(BeatFraction.Half)),
      music.PlaybackMode.UntilDone
    );
    music.play(
      music.tonePlayable(277, music.beat(BeatFraction.Half)),
      music.PlaybackMode.UntilDone
    );
    music.play(
      music.tonePlayable(440, music.beat(BeatFraction.Half)),
      music.PlaybackMode.UntilDone
    );
    music.play(
      music.tonePlayable(370, music.beat(BeatFraction.Half)),
      music.PlaybackMode.UntilDone
    );
    music.play(
      music.tonePlayable(262, music.beat(BeatFraction.Half)),
      music.PlaybackMode.UntilDone
    );
    music.play(
      music.tonePlayable(247, music.beat(BeatFraction.Whole)),
      music.PlaybackMode.UntilDone
    );
    music.play(
      music.tonePlayable(349, music.beat(BeatFraction.Half)),
      music.PlaybackMode.UntilDone
    );
    music.play(
      music.tonePlayable(294, music.beat(BeatFraction.Half)),
      music.PlaybackMode.UntilDone
    );
    music.play(
      music.tonePlayable(247, music.beat(BeatFraction.Half)),
      music.PlaybackMode.UntilDone
    );
    music.play(
      music.tonePlayable(330, music.beat(BeatFraction.Quarter)),
      music.PlaybackMode.UntilDone
    );
    music.rest(music.beat(BeatFraction.Quarter));
    music.play(
      music.tonePlayable(330, music.beat(BeatFraction.Quarter)),
      music.PlaybackMode.UntilDone
    );
    music.rest(music.beat(BeatFraction.Quarter));
    music.play(
      music.tonePlayable(330, music.beat(BeatFraction.Half)),
      music.PlaybackMode.UntilDone
    );
    music.rest(music.beat(BeatFraction.Double));
    music.play(
      music.tonePlayable(466, music.beat(BeatFraction.Quarter)),
      music.PlaybackMode.UntilDone
    );
    music.rest(music.beat(BeatFraction.Quarter));
    music.play(
      music.tonePlayable(494, music.beat(BeatFraction.Quarter)),
      music.PlaybackMode.UntilDone
    );
    music.rest(music.beat(BeatFraction.Quarter));
    music.play(
      music.tonePlayable(554, music.beat(BeatFraction.Quarter)),
      music.PlaybackMode.UntilDone
    );
    music.rest(music.beat(BeatFraction.Quarter));
    music.play(
      music.tonePlayable(587, music.beat(BeatFraction.Quarter)),
      music.PlaybackMode.UntilDone
    );
    music.rest(music.beat(BeatFraction.Quarter));
    music.play(
      music.tonePlayable(740, music.beat(BeatFraction.Quarter)),
      music.PlaybackMode.UntilDone
    );
    music.rest(music.beat(BeatFraction.Quarter));
    music.play(
      music.tonePlayable(880, music.beat(BeatFraction.Whole)),
      music.PlaybackMode.UntilDone
    );
  } else if (receivedNumber == 2) {
    music.setTempo(200);
    for (let index = 0; index < 2; index++) {
      for (let index = 0; index < 3; index++) {
        music.play(
          music.tonePlayable(523, music.beat(BeatFraction.Quarter)),
          music.PlaybackMode.UntilDone
        );
        music.rest(music.beat(BeatFraction.Quarter));
        music.play(
          music.tonePlayable(392, music.beat(BeatFraction.Quarter)),
          music.PlaybackMode.UntilDone
        );
        music.rest(music.beat(BeatFraction.Quarter));
        music.play(
          music.tonePlayable(587, music.beat(BeatFraction.Quarter)),
          music.PlaybackMode.UntilDone
        );
        music.rest(music.beat(BeatFraction.Quarter));
        music.play(
          music.tonePlayable(392, music.beat(BeatFraction.Quarter)),
          music.PlaybackMode.UntilDone
        );
        music.rest(music.beat(BeatFraction.Quarter));
        music.play(
          music.tonePlayable(622, music.beat(BeatFraction.Quarter)),
          music.PlaybackMode.UntilDone
        );
        music.rest(music.beat(BeatFraction.Quarter));
        music.play(
          music.tonePlayable(392, music.beat(BeatFraction.Quarter)),
          music.PlaybackMode.UntilDone
        );
        music.rest(music.beat(BeatFraction.Quarter));
        music.play(
          music.tonePlayable(587, music.beat(BeatFraction.Quarter)),
          music.PlaybackMode.UntilDone
        );
        music.rest(music.beat(BeatFraction.Quarter));
        music.play(
          music.tonePlayable(392, music.beat(BeatFraction.Quarter)),
          music.PlaybackMode.UntilDone
        );
        music.rest(music.beat(BeatFraction.Quarter));
      }
      music.play(
        music.tonePlayable(698, music.beat(BeatFraction.Half)),
        music.PlaybackMode.UntilDone
      );
      music.rest(music.beat(BeatFraction.Half));
      music.play(
        music.tonePlayable(622, music.beat(BeatFraction.Half)),
        music.PlaybackMode.UntilDone
      );
      music.rest(music.beat(BeatFraction.Half));
      music.play(
        music.tonePlayable(587, music.beat(BeatFraction.Double)),
        music.PlaybackMode.UntilDone
      );
      music.rest(music.beat(BeatFraction.Half));
    }
    music.play(
      music.tonePlayable(494, music.beat(BeatFraction.Half)),
      music.PlaybackMode.UntilDone
    );
    music.rest(music.beat(BeatFraction.Half));
    music.play(
      music.tonePlayable(523, music.beat(BeatFraction.Half)),
      music.PlaybackMode.UntilDone
    );
    music.rest(music.beat(BeatFraction.Half));
    music.play(
      music.tonePlayable(784, music.beat(BeatFraction.Half)),
      music.PlaybackMode.UntilDone
    );
    music.rest(music.beat(BeatFraction.Half));
    music.play(
      music.tonePlayable(740, music.beat(BeatFraction.Half)),
      music.PlaybackMode.UntilDone
    );
    music.rest(music.beat(BeatFraction.Half));
    music.play(
      music.tonePlayable(784, music.beat(BeatFraction.Half)),
      music.PlaybackMode.UntilDone
    );
    music.rest(music.beat(BeatFraction.Half));
    music.play(
      music.tonePlayable(831, music.beat(BeatFraction.Half)),
      music.PlaybackMode.UntilDone
    );
    music.rest(music.beat(BeatFraction.Half));
    music.play(
      music.tonePlayable(784, music.beat(BeatFraction.Half)),
      music.PlaybackMode.UntilDone
    );
    music.rest(music.beat(BeatFraction.Half));
    music.play(
      music.tonePlayable(740, music.beat(BeatFraction.Half)),
      music.PlaybackMode.UntilDone
    );
    music.rest(music.beat(BeatFraction.Half));
    music.play(
      music.tonePlayable(784, music.beat(BeatFraction.Half)),
      music.PlaybackMode.UntilDone
    );
    music.rest(music.beat(BeatFraction.Half));
    music.play(
      music.tonePlayable(523, music.beat(BeatFraction.Double)),
      music.PlaybackMode.UntilDone
    );
  }
});
input.onButtonPressed(Button.A, function () {
  led.unplot(monPos[0], monPos[1]);
  if (monPos[0] != 0) {
    monPos[0] = monPos[0] - 1;
  }
  led.plot(monPos[0], monPos[1]);
});
function drop() {
  for (let item of queue) {
    if (item[1] <= 4) {
      led.plotBrightness(item[0], item[1], 0);
      item[1] = item[1] + 1;
      led.plotBrightness(item[0], item[1], item[2]);
    }
  }
}
function judge(time: number) {
  seed = 14;
  if (time >= 20 && time < 40) {
    seed = 7;
  } else if (time >= 40) {
    seed = -7;
  }
  for (let item3 of queue) {
    if (item3[0] == monPos[0] && item3[1] == monPos[1]) {
      scoreArr = item3;
      score += scoreArr[2] / seed;
    }
  }
  return scoreArr;
}
input.onButtonPressed(Button.B, function () {
  led.unplot(monPos[0], monPos[1]);
  if (monPos[0] != 4) {
    monPos[0] = monPos[0] + 1;
  }
  led.plot(monPos[0], monPos[1]);
});
function generateBananas() {
  let y: number;
  for (let index = 0; index < randint(1, 3); index++) {
    y = 0;
    x = randint(0, 4);
    if (randint(0, 100) <= 50) {
      bright = 70;
    } else {
      bright = 140;
    }
    if (isValid(x, y)) {
      led.plotBrightness(x, y, bright);
      queue.insertAt(0, [x, y, bright]);
    }
  }
}
function isValid(x2: number, y2: number) {
  for (let item2 of queue) {
    if (item2[0] == x2 && item2[1] == y2) {
      return false;
    }
  }
  return true;
}
let bright = 0;
let x = 0;
let score = 0;
let scoreArr: number[] = [];
let seed = 0;
let queue: number[][] = [];
let popBan: number[] = [];
let second = 0;
let monPos: number[] = [];
let latency = 1000;
monPos = [2, 4];
radio.setGroup(5);
basic.showString("START!");
led.plot(monPos[0], monPos[1]);
while (second <= 60) {
  // radio.sendNumber(1)
  // radio.sendNumber(2)
  if (second == 0) {
    latency = 700;
  } else if (second == 20) {
    latency = 400;
  }
  drop();
  if (second % 2 == 1) {
    generateBananas();
    popBan = judge(second);
  }
  led.plotBrightness(popBan[0], popBan[1], 0);
  led.plot(monPos[0], monPos[1]);
  // console.log(`sec: ${second}, score: ${score}`);
  basic.pause(latency);
  second += 1;
}
// basic.showString("" + (`score: ${score}`))
basic.showString("END");
basic.clearScreen();
